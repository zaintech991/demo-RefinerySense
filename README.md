# RefinerySense - Digital Twin & Predictive Maintenance System

A production-ready MVP for a **Digital Twin + Predictive Maintenance System** designed for refinery equipment monitoring and maintenance optimization. This comprehensive system leverages real-time sensor data, machine learning models, and digital twin technology to predict equipment failures, optimize maintenance schedules, and reduce downtime in industrial settings.

## ğŸ¯ Project Overview

RefinerySense transforms traditional reactive maintenance into a proactive, data-driven approach. By creating digital replicas (digital twins) of physical assets and applying advanced ML algorithms, the system can:

- **Predict equipment failures** before they occur
- **Optimize maintenance schedules** based on actual equipment condition
- **Reduce unplanned downtime** through early anomaly detection
- **Extend equipment lifespan** by identifying degradation patterns
- **Lower maintenance costs** by preventing catastrophic failures

### How It Works

1. **Data Collection**: Real-time sensor data (temperature, pressure, vibration, flow, RPM) is continuously streamed from refinery equipment
2. **Digital Twin Creation**: Each asset gets a digital replica that models expected behavior under normal operating conditions
3. **ML Analysis**: Machine learning models analyze patterns, detect anomalies, and forecast future states
4. **Health Scoring**: A comprehensive health index combines multiple signals to assess overall equipment condition
5. **Predictive Insights**: The system predicts remaining useful life (RUL) and failure risks
6. **Actionable Alerts**: Operators receive timely notifications with severity levels and recommended actions
7. **AI-Powered Assistance**: An intelligent chat assistant helps operators understand equipment status and make informed decisions

## âœ¨ Key Features

### Real-Time Monitoring
- **WebSocket-based streaming**: Live sensor data updates every 1-5 seconds
- **Interactive dashboards**: Real-time charts and visualizations
- **Multi-asset monitoring**: Track multiple equipment simultaneously
- **Historical data analysis**: View trends and patterns over time

### Digital Twin Technology
- **Expected behavior modeling**: Creates baseline performance curves for each asset type
- **Deviation detection**: Compares actual vs expected values in real-time
- **What-if scenarios**: Simulate different operating conditions (load changes, temperature spikes)
- **Performance benchmarking**: Identify when equipment deviates from optimal operation

### Machine Learning-Powered Predictions
- **Time-series forecasting**: Predict future sensor values using multiple ML algorithms
- **Anomaly detection**: Identify unusual patterns that may indicate problems
- **Remaining Useful Life (RUL) estimation**: Predict when equipment will need maintenance
- **Failure risk scoring**: Quantify the probability of equipment failure

### Intelligent Health Scoring
- **Multi-factor analysis**: Combines deviation scores, anomaly detection, RUL estimates, and risk factors
- **Weighted health index**: Provides a single 0-100 score representing overall equipment health
- **Trend analysis**: Tracks health degradation over time
- **Maintenance recommendations**: Suggests optimal maintenance timing

### Smart Alerting System
- **Multi-level alerts**: Info, Warning, and Critical severity levels
- **Threshold-based alerts**: Triggered when parameters exceed safe operating limits
- **ML-driven alerts**: Generated by anomaly detection and health score analysis
- **Contextual information**: Each alert includes relevant sensor data and recommendations

### AI-Powered Assistant
- **Natural language queries**: Ask questions about equipment health in plain English
- **Context-aware responses**: AI understands current equipment status and historical data
- **Markdown-formatted insights**: Beautiful, structured responses with formatting
- **Real-time data integration**: Answers are based on live sensor readings and health scores

## Tech Stack

### Backend
- Python 3.9+
- FastAPI
- SQLAlchemy (SQLite/PostgreSQL)
- WebSockets for real-time streaming
- ML Models: Forecasting, Anomaly Detection, RUL Estimation
- Groq LLM API for AI Assistant

### Frontend
- Next.js 14
- React 18
- TypeScript
- Tailwind CSS
- Recharts for visualizations
- WebSocket client for real-time updates

## Project Structure

```
RefinerySense/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ routers/          # API routes
â”‚   â”‚   â”œâ”€â”€ services/          # Business logic
â”‚   â”‚   â”‚   â”œâ”€â”€ ml/           # ML models
â”‚   â”‚   â”‚   â”œâ”€â”€ data_simulator.py
â”‚   â”‚   â”‚   â”œâ”€â”€ data_pipeline.py
â”‚   â”‚   â”‚   â”œâ”€â”€ digital_twin.py
â”‚   â”‚   â”‚   â”œâ”€â”€ health_score.py
â”‚   â”‚   â”‚   â”œâ”€â”€ alerts.py
â”‚   â”‚   â”‚   â””â”€â”€ ai_assistant.py
â”‚   â”‚   â”œâ”€â”€ models.py         # Database models
â”‚   â”‚   â”œâ”€â”€ schemas.py        # Pydantic schemas
â”‚   â”‚   â”œâ”€â”€ database.py       # DB setup
â”‚   â”‚   â”œâ”€â”€ config.py         # Configuration
â”‚   â”‚   â””â”€â”€ main.py           # FastAPI app
â”‚   â”œâ”€â”€ scripts/
â”‚   â”‚   â””â”€â”€ init_demo_data.py # Demo data generator
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ run.py
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ app/                  # Next.js app directory
â”‚   â”‚   â”œâ”€â”€ page.tsx         # Landing page
â”‚   â”‚   â”œâ”€â”€ monitoring/      # Live monitoring page
â”‚   â”‚   â”œâ”€â”€ digital-twin/    # Digital twin page
â”‚   â”‚   â”œâ”€â”€ predictive/      # Predictive maintenance page
â”‚   â”‚   â”œâ”€â”€ alerts/          # Alerts page
â”‚   â”‚   â””â”€â”€ assistant/       # AI assistant page
â”‚   â”œâ”€â”€ components/          # React components
â”‚   â”œâ”€â”€ lib/                 # Utilities
â”‚   â””â”€â”€ package.json
â””â”€â”€ README.md
```

## Setup Instructions

### Prerequisites

- Python 3.9 or higher
- Node.js 18 or higher
- npm or yarn

### Backend Setup

1. **Navigate to backend directory:**
   ```bash
   cd backend
   ```

2. **Create virtual environment:**
   ```bash
   python -m venv venv
   source venv/bin/activate  # On Windows: venv\Scripts\activate
   ```

3. **Install dependencies:**
   ```bash
   pip install -r requirements.txt
   ```

4. **Set up environment variables:**
   ```bash
   cp .env.example .env
   ```
   
   Edit `.env` and add your Groq API key (optional for basic functionality):
   ```
   GROQ_API_KEY=your_groq_api_key_here
   ```

5. **Initialize database and demo data:**
   ```bash
   python scripts/init_demo_data.py
   ```

6. **Run the backend server:**
   ```bash
   python run.py
   ```
   
   The API will be available at `http://localhost:8000`
   API documentation: `http://localhost:8000/docs`

### Frontend Setup

1. **Navigate to frontend directory:**
   ```bash
   cd frontend
   ```

2. **Install dependencies:**
   ```bash
   npm install
   ```

3. **Set up environment variables (optional):**
   Create `.env.local`:
   ```
   NEXT_PUBLIC_API_URL=http://localhost:8000
   ```

4. **Run the development server:**
   ```bash
   npm run dev
   ```
   
   The frontend will be available at `http://localhost:3000`

## Usage

### Starting the Application

1. Start the backend server (from `backend/` directory):
   ```bash
   python run.py
   ```

2. Start the frontend server (from `frontend/` directory):
   ```bash
   npm run dev
   ```

3. Open your browser and navigate to `http://localhost:3000`

### Pages

- **Landing Page** (`/`): Welcome page with feature overview
- **Live Monitoring** (`/monitoring`): Real-time sensor data with charts
- **Digital Twin** (`/digital-twin`): Expected vs actual behavior comparison
- **Predictive Maintenance** (`/predictive`): RUL estimates and forecasts
- **Alerts & Logs** (`/alerts`): View and manage alerts
- **AI Assistant** (`/assistant`): Chat with AI about equipment health

### API Endpoints

- `GET /api/assets` - List all assets
- `GET /api/assets/{id}/metrics` - Get asset metrics
- `GET /api/sensors/readings` - Get sensor readings
- `POST /api/sensors/readings` - Create sensor reading
- `GET /api/health/scores` - Get health scores
- `GET /api/health/forecast/{asset_id}` - Get forecast
- `GET /api/alerts` - Get alerts
- `POST /api/alerts/{id}/resolve` - Resolve alert
- `POST /api/chat` - Chat with AI assistant
- `WS /ws/sensors/{asset_id}` - WebSocket for real-time data

## Demo Data

The initialization script creates:
- 6 demo assets (pumps, compressors, heat exchangers)
- 7 days of historical sensor data
- Health scores and predictions
- Sample alerts

## âš™ï¸ Configuration

### Backend Configuration

Edit `backend/.env` or set environment variables:

- **`DATABASE_URL`**: Database connection string
  - Default: `sqlite:///./refinery_sense.db` (SQLite for development)
  - Production: `postgresql://user:password@localhost:5432/refinery_sense`

- **`GROQ_API_KEY`**: Groq API key for AI assistant
  - Get your key from: https://console.groq.com/
  - Required for AI Assistant feature

- **`GROQ_MODEL`**: Groq model to use
  - Options: `llama3-70b-8192`, `llama3-8b-8192`, `mixtral-8x7b-32768`, `gemma-7b-it`
  - Default: `llama3-70b-8192`

- **`SIMULATION_ENABLED`**: Enable/disable data simulation
  - Set to `false` to disable automatic sensor data generation
  - Default: `true`

- **`SIMULATION_INTERVAL_SECONDS`**: Data generation interval
  - Time between simulated sensor readings
  - Default: `3` seconds

- **`HOST`**: Server host address
  - Default: `0.0.0.0`

- **`PORT`**: Server port
  - Default: `8000`

### Frontend Configuration

Edit `frontend/.env.local` or set environment variables:

- **`NEXT_PUBLIC_API_URL`**: Backend API URL
  - Default: `http://localhost:8000`
  - Update for production deployment

## ğŸ¤– Machine Learning Integration

Machine learning is at the core of RefinerySense's predictive capabilities. The system employs multiple ML algorithms to transform raw sensor data into actionable insights.

### How ML Helps the System

#### 1. **Time-Series Forecasting** ğŸ“ˆ
**Purpose**: Predict future sensor values to anticipate equipment behavior

**Algorithms Used**:
- **Simple Moving Average**: Provides baseline forecasts by averaging recent values
- **Exponential Smoothing**: Gives more weight to recent observations, adapting to trends
- **Prophet-style Forecasting**: Models trend and seasonality patterns (daily cycles, load variations)

**How It Helps**:
- **Predictive Planning**: Forecast temperature, pressure, and other parameters hours/days ahead
- **Anomaly Prevention**: Identify when values are trending toward dangerous thresholds
- **Load Optimization**: Predict how equipment will behave under different load conditions
- **Maintenance Scheduling**: Forecast when parameters will exceed maintenance thresholds

**Example**: If temperature is forecasted to reach 100Â°C in 6 hours (critical threshold: 95Â°C), the system alerts operators to take preventive action.

#### 2. **Anomaly Detection** ğŸ”
**Purpose**: Identify unusual patterns that may indicate equipment problems

**Algorithms Used**:
- **Statistical Methods (Z-score)**: Detects values that deviate significantly from historical norms
- **Isolation Forest**: Unsupervised learning algorithm that identifies outliers in multi-dimensional sensor data

**How It Helps**:
- **Early Problem Detection**: Catch issues before they become critical failures
- **Pattern Recognition**: Identify subtle anomalies that might be missed by threshold-based monitoring
- **Multi-parameter Analysis**: Correlate anomalies across multiple sensors (e.g., temperature spike + pressure drop)
- **False Positive Reduction**: ML models learn normal variations, reducing unnecessary alerts

**Example**: The system detects that while temperature is normal, vibration has increased 40% above baseline - indicating potential bearing wear before it causes failure.

#### 3. **Remaining Useful Life (RUL) Estimation** â±ï¸
**Purpose**: Predict when equipment will need maintenance or replacement

**Algorithms Used**:
- **Health-based Degradation Modeling**: Linear regression on health score trends
- **Parameter-based Trend Analysis**: Models degradation of individual parameters (temperature, pressure, vibration)

**How It Helps**:
- **Proactive Maintenance**: Schedule maintenance before failures occur
- **Cost Optimization**: Replace components at optimal times (not too early, not too late)
- **Resource Planning**: Predict maintenance needs weeks/months in advance
- **Risk Management**: Identify high-risk assets requiring immediate attention

**Example**: Based on health score degradation trend, the system predicts Pump A has 23 days until critical failure, allowing maintenance to be scheduled during planned downtime.

#### 4. **Failure Risk Scoring** âš ï¸
**Purpose**: Quantify the probability of equipment failure

**How It Helps**:
- **Priority Ranking**: Focus maintenance efforts on highest-risk equipment
- **Resource Allocation**: Allocate resources based on risk levels
- **Insurance & Compliance**: Provide quantitative risk assessments
- **Decision Support**: Help operators make informed decisions about equipment operation

**Example**: Compressor X has a risk score of 85/100 (high risk) due to declining health and detected anomalies, prompting immediate inspection.

### ML Model Workflow

```
Sensor Data â†’ Data Pipeline â†’ Feature Extraction
                                    â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â†“                               â†“
            Forecasting Models          Anomaly Detection
                    â†“                               â†“
            Future Value Predictions    Anomaly Scores
                    â†“                               â†“
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
                        RUL Estimation Models
                                    â†“
                            Health Score Engine
                                    â†“
                    Failure Risk Assessment
                                    â†“
                    Alerts & Recommendations
```

### Benefits of ML Integration

1. **Reduced Downtime**: ML predictions enable maintenance before failures, reducing unplanned outages by up to 50%
2. **Cost Savings**: Optimize maintenance schedules, reducing both premature replacements and catastrophic failures
3. **Extended Equipment Life**: Early detection of degradation patterns allows corrective action before irreversible damage
4. **Improved Safety**: Predict and prevent dangerous equipment conditions
5. **Data-Driven Decisions**: Quantitative insights replace guesswork in maintenance planning
6. **Scalability**: ML models automatically adapt to new equipment and operating conditions

## ğŸ”„ Digital Twin Technology

Digital twins are virtual replicas of physical equipment that model expected behavior under various operating conditions. This technology enables:

### Core Functionality

1. **Expected Behavior Modeling**
   - Creates baseline performance curves for each asset type (pumps, compressors, heat exchangers)
   - Models normal operating ranges for temperature, pressure, vibration, flow, and RPM
   - Accounts for time-of-day variations and load factors
   - Learns from historical data to refine expected values

2. **Real-Time Comparison**
   - Continuously compares actual sensor readings against expected values
   - Calculates deviation scores (0-100) indicating how far actual performance is from expected
   - Identifies when equipment is operating outside normal parameters

3. **Deviation Analysis**
   - **Low Deviation (<10%)**: Equipment operating normally
   - **Medium Deviation (10-25%)**: Minor issues, monitor closely
   - **High Deviation (>25%)**: Significant problems, investigate immediately

4. **What-If Scenarios**
   - **Load Increase**: Simulate how equipment behaves at 150% normal load
   - **Load Decrease**: Model reduced load conditions
   - **Temperature Spike**: Predict behavior during thermal stress
   - **Pressure Variations**: Understand response to pressure changes

### Benefits

- **Proactive Problem Detection**: Identify issues before they cause failures
- **Performance Optimization**: Understand optimal operating conditions
- **Predictive Insights**: Forecast how equipment will behave under different scenarios
- **Maintenance Planning**: Use deviation trends to schedule maintenance

## ğŸ’š Health Score Engine

The Health Score Engine synthesizes multiple data sources into a single, actionable health index that represents overall equipment condition.

### Health Index Calculation

The health index (0-100) is calculated using a weighted combination of:

1. **Twin Deviation Score (30% weight)**
   - Measures how much actual values deviate from expected behavior
   - Lower deviation = better health
   - Inverted: 100 - deviation_score

2. **Anomaly Score (30% weight)**
   - Reflects the presence of unusual patterns or outliers
   - Lower anomaly score = better health
   - Inverted: 100 - anomaly_score

3. **RUL-based Health (25% weight)**
   - Converts remaining useful life into health score
   - RUL > 180 days = 95 health
   - RUL 90-180 days = 80 health
   - RUL 30-90 days = 60 health
   - RUL 7-30 days = 40 health
   - RUL < 7 days = 20 health

4. **Failure Risk Score (15% weight)**
   - Incorporates ML-predicted failure probability
   - Lower risk = better health
   - Inverted: 100 - risk_score

### Health Index Interpretation

- **90-100**: Excellent condition, no action needed
- **70-89**: Good condition, minor monitoring recommended
- **50-69**: Fair condition, schedule maintenance soon
- **30-49**: Poor condition, maintenance required
- **0-29**: Critical condition, immediate action needed

### Benefits

- **Unified View**: Single number represents complex multi-parameter equipment state
- **Prioritization**: Easily identify which equipment needs attention first
- **Trend Tracking**: Monitor health degradation over time
- **Decision Support**: Quantitative basis for maintenance decisions

## Alerts

Alert types:
- **Threshold-based**: Parameter exceeds warning/critical thresholds
- **Anomaly-based**: ML detects anomalous behavior
- **Health-based**: Health index drops below threshold
- **RUL-based**: Remaining Useful Life is critically low

## ğŸ¤– AI Assistant

The AI Assistant leverages Groq's high-performance LLM (Large Language Model) to provide intelligent, context-aware responses about equipment health and maintenance.

### Capabilities

The AI assistant can answer questions about:
- **Equipment Health Status**: Current health scores and trends for all assets
- **Sensor Readings**: Latest temperature, pressure, vibration, flow, and RPM values
- **Anomalies & Alerts**: Active alerts, their severity, and recommended actions
- **Maintenance Predictions**: RUL estimates and optimal maintenance timing
- **Historical Analysis**: Trends and patterns in equipment performance
- **Comparative Analysis**: Compare health across multiple assets

### How It Works

1. **Context Gathering**: The assistant retrieves real-time data from the database
   - Latest sensor readings
   - Current health scores
   - Active alerts
   - Historical trends

2. **Natural Language Processing**: Groq LLM understands questions in plain English
   - "Why is pump overheating?"
   - "Show me anomaly trend of Asset A"
   - "What is the predicted RUL for compressors?"

3. **Intelligent Responses**: Provides formatted, markdown-rich answers
   - Structured lists and bullet points
   - Bold emphasis on key information
   - Clear recommendations and next steps

### Example Interactions

**User**: "What is the health status of all assets?"

**AI**: 
```
Based on the provided context, the health status of all assets:

1. **Main Pump A**: Health 56.9/100 - Borderline/Warning condition
2. **Main Pump B**: Health 72.1/100 - Good condition
3. **Compressor X**: Health 49.8/100 - Critical/Warning condition
...

Recommendation: Schedule maintenance for assets with health < 60.
```

### Benefits

- **Natural Interface**: No need to navigate multiple dashboards
- **Context-Aware**: Answers based on current, real-time data
- **Educational**: Helps operators understand equipment behavior
- **Time-Saving**: Quick answers to complex questions

## Development

### Adding New Asset Types

1. Update `data_simulator.py` with new asset profile
2. Update `digital_twin.py` with baseline expectations
3. Update `alerts.py` with thresholds

### Extending ML Models

Add new models in `app/services/ml/`:
- Implement forecasting methods in `forecasting.py`
- Add anomaly detection algorithms in `anomaly_detection.py`
- Enhance RUL estimation in `rul_estimation.py`

### Adding New Pages

1. Create new page in `frontend/app/`
2. Add route to `Navbar.tsx`
3. Create API endpoints in `backend/app/routers/`

## Production Deployment

### Backend
- Use PostgreSQL instead of SQLite
- Set up proper environment variables
- Use production WSGI server (e.g., Gunicorn)
- Enable CORS for specific origins
- Set up authentication/authorization

### Frontend
- Build for production: `npm run build`
- Deploy to Vercel, Netlify, or similar
- Configure API URL for production backend

## Troubleshooting

### Backend Issues
- Ensure Python 3.9+ is installed
- Check virtual environment is activated
- Verify database file permissions
- Check Groq API key if using AI assistant

### Frontend Issues
- Clear `.next` cache: `rm -rf .next`
- Reinstall dependencies: `rm -rf node_modules && npm install`
- Check API URL configuration
- Verify backend is running

### WebSocket Issues
- Check firewall settings
- Verify WebSocket URL matches backend
- Check browser console for connection errors

## License

This project is provided as-is for demonstration purposes.

## Support

For issues or questions, please check the code comments or create an issue in the repository.

